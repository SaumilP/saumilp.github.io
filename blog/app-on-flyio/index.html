<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta property="og:image" content="/img/profile.webp" />
    
    
    <meta name="description" content="Test driving Fly.io ..." />
    
    

    <title>Learning to fly with Rust | Code, Thoughts and Ideas</title>

    <link rel="apple-touch-icon" sizes="180x180" href="https://saumilp.github.io/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://saumilp.github.io/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://saumilp.github.io/icons/favicon-16x16.png">
    <link rel="shortcut icon" type="image/x-icon" href="https://saumilp.github.io/icons/favicon.ico">
    <link rel="manifest" href="https://saumilp.github.io/icons/site.webmanifest">
    <link rel="mask-icon" href="https://saumilp.github.io/icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    

    
    <link rel="alternate" type="application/atom+xml" title="RSS" href="https://saumilp.github.io/atom.xml">
    

    <link rel="stylesheet" type="text/css" href="/css/style.css">
     
</head>

<body>
    <header class="navbar">
        <div class="navbarlog""><h1><a href="https://saumilp.github.io" title="Code, Thoughts and Ideas"><svg width="150" height="90" viewBox="0 0 369.65517241379314 75.46182453925974" class="looka-1j8o68f"><defs id="SvgjsDefs2262"></defs><g id="SvgjsG2263" featurekey="symbolFeature-0" transform="matrix(0.1539408866995074,0,0,0.1539408866995074,-9.236453201970443,-1.6779556063008427)" fill="#d9d9d9"><title xmlns="http://www.w3.org/2000/svg">Machine Mind</title><g xmlns="http://www.w3.org/2000/svg"><path d="M261,62.8c3.3,0,6-2.7,6-6V16.9c0-3.3-2.7-6-6-6s-6,2.7-6,6v39.9C255,60.1,257.7,62.8,261,62.8z"></path><path d="M446,201h-39.9c-3.3,0-6,2.7-6,6s2.7,6,6,6H446c3.3,0,6-2.7,6-6S449.3,201,446,201z"></path><path d="M111.9,207c0-3.3-2.7-6-6-6H66c-3.3,0-6,2.7-6,6s2.7,6,6,6h39.9C109.2,213,111.9,210.3,111.9,207z"></path><path d="M369.3,102.1L400.4,71c2.3-2.3,2.3-6.1,0-8.5c-2.3-2.3-6.1-2.3-8.5,0l-31.1,31.1c-2.3,2.3-2.3,6.1,0,8.5   C363.2,104.4,367,104.4,369.3,102.1z"></path><path d="M142.7,102.1c1.1,1.1,2.7,1.8,4.2,1.8c3.3,0,6-2.7,6-6c0-1.6-0.6-3.1-1.8-4.2l-31.1-31.1c-2.3-2.3-6.1-2.3-8.5,0   s-2.3,6.1,0,8.5L142.7,102.1z"></path><path d="M332.3,249c0-7.2-5.8-12.9-12.9-12.9c-7.2,0-12.9,5.8-12.9,12.9c0,3.4,1.4,6.7,3.8,9.2c2.4,2.4,5.7,3.8,9.2,3.8   C326.5,262,332.3,256.2,332.3,249z"></path><path d="M202.7,239.9c-5.1-5.1-13.3-5.1-18.3,0c-5.1,5.1-5.1,13.3,0,18.3c2.4,2.4,5.7,3.8,9.2,3.8c3.4,0,6.7-1.4,9.2-3.8   C207.7,253.1,207.7,244.9,202.7,239.9z"></path><path d="M308,457h-14.9c-3.3,0-6-2.7-6-6s2.7-6,6-6H308v-24H204v24h68.4c3.3,0,6,2.7,6,6s-2.7,6-6,6H204v2.3   c-0.1,7.5,5.8,13.6,13.3,13.7c0.1,0,0.2,0,0.3,0h76.8c7.5,0.1,13.6-5.9,13.6-13.4c0-0.1,0-0.2,0-0.3V457z"></path><path d="M257,98.1c-0.4,0-0.7,0-1,0c-62.2,0-114.7,46.2-122.6,107.9c-0.1,0.8-0.3,2.8-0.4,7.3c-0.4,13.4-3,26.6-7.8,39.1L107.1,300   h38.8c3.3,0,6.1,2.7,6.1,6v43.4c-0.1,12.9,10.3,23.4,23.2,23.4c0.3,0,0.5,0,0.8,0c0,0,0.1,0.1,0.1,0.1l9.6,0l0.2,0   c4.7-0.1,9.3,1.7,12.7,5c3.4,3.3,5.4,7.8,5.4,12.5V409h22v-93.5c0.1-7.2-5.6-13.2-12.8-13.3c-0.1,0-0.1,0-0.2,0   c-13.8,0-25-11.3-25-25.1c0-0.1,0-0.1,0-0.2v-3.7c-4.5-0.9-8.7-3.2-11.9-6.6c-9.8-9.7-9.9-25.4-0.2-35.2c9.7-9.8,25.4-9.9,35.2-0.2   c4.7,4.7,7.4,11.1,7.4,17.7c0.1,6.6-2.4,12.9-7.1,17.6c-3.2,3.1-7.1,5.4-11.4,6.6v3.7c-0.1,7.2,5.6,13.2,12.8,13.3   c0.1,0,0.1,0,0.2,0c13.8,0,25,11.3,25,25.1c0,0.1,0,0.1,0,0.2V409h12V212.7c-4.3-1.3-8.2-3.6-11.4-6.7h0.1   c-9.8-9.7-9.8-25.5-0.1-35.3c9.7-9.8,25.5-9.8,35.3-0.1c9.8,9.7,9.8,25.5,0.1,35.3c0,0-0.1,0.1-0.1,0.1c-3.2,3.4-7.3,5.7-11.8,6.6   V409h13v-93.5c-0.1-13.8,11-25.2,24.8-25.3c0.1,0,0.1,0,0.2,0c7.2,0,13-5.9,13-13.1c0-0.1,0-0.1,0-0.2v-3.7   c-4.3-1.2-8.3-3.4-11.5-6.6c-9.7-9.8-9.6-25.6,0.1-35.3c9.6-9.9,25.3-10.1,35.2-0.6c9.9,9.6,10.1,25.3,0.6,35.2   c-0.2,0.2-0.4,0.4-0.6,0.6c-3.2,3.3-7.3,5.6-11.8,6.6v3.7c0.1,13.8-11,25.2-24.8,25.3c-0.1,0-0.1,0-0.2,0c-7.2,0-13,5.9-13,13.1   c0,0.1,0,0.1,0,0.2V409h21v-24.4c0-27.2,11.8-53.6,32.1-72.4c49.9-46.5,52.7-124.7,6.2-174.7C323.2,112.7,290.9,98.5,257,98.1z"></path><path d="M265.6,179.3c-5.1-5.1-13.3-5.1-18.3,0c-5.1,5.1-5.1,13.3,0,18.3c5.1,5,13.2,5,18.3,0C270.6,192.5,270.6,184.3,265.6,179.3   z"></path><path d="M250,495.1c0,3.3,2.7,6,6,6s6-2.7,6-6V479h-12V495.1z"></path></g></g><g id="SvgjsG2264" featurekey="nameFeature-0" transform="matrix(1.4494354369584879,0,0,1.4494354369584879,77.68090309352301,-0.39322247892315687)" fill="#3b4972"><path d="M5.32 28.52 l-3.72 -3.72 l0 -9.08 l3.72 -3.72 l3.28 0 l0 5.04 l-1.2 0 l-0.76 0.76 l0 4.92 l0.76 0.76 l6.16 0 l3.72 3.72 l0 1.32 l-11.96 0 z M5.32 40 l-3.72 -3.72 l0 -5.24 l5.04 0 l0 3.16 l0.76 0.76 l4.08 0 l0.76 -0.76 l0 -4 l5.04 0 l0 6.08 l-3.72 3.72 l-8.24 0 z M12.24 20.96 l0 -3.16 l-0.76 -0.76 l-1.2 0 l0 -5.04 l3.28 0 l3.72 3.72 l0 5.24 l-5.04 0 z M19.68 40 l2.28 -11.2 l8.56 0 l-1.72 -8.56 l-1.36 6.88 l-5.16 0 l3.04 -15.12 l6.96 0 l4.4 21.84 l-10.6 0 l-1.24 6.16 l-5.16 0 z M32.8 40 l-0.92 -4.48 l5.16 0 l0.88 4.48 l-5.12 0 z M49.28 40 l0 -5.04 l1.48 0 l0.76 -0.76 l0 -22.2 l5.04 0 l0 24.28 l-3.72 3.72 l-3.56 0 z M44.04 40 l-3.72 -3.72 l0 -24.28 l5.04 0 l0 22.2 l0.76 0.76 l1.48 0 l0 5.04 l-3.56 0 z M67.36 31.32 l-7.6 -19.32 l5.4 0 l4.2 10.6 l4.16 -10.6 l5.4 0 l-7.6 19.32 l-3.96 0 z M59.839999999999996 40 l0 -23.24 l5.04 12.84 l0 10.4 l-5.04 0 z M73.84 40 l0 -10.4 l5.04 -12.84 l0 23.24 l-5.04 0 z M82.11999999999999 25.16 l0 -13.16 l5.04 0 l0 13.16 l-5.04 0 z M82.11999999999999 40 l0 -13.16 l5.04 0 l0 13.16 l-5.04 0 z M90.35999999999999 33.28 l0 -21.28 l5.04 0 l0 21.28 l-5.04 0 z M90.35999999999999 40 l0 -5.04 l5.04 0 l0 5.04 l-5.04 0 z M97.07999999999998 40 l0 -5.04 l6.16 0 l0 5.04 l-6.16 0 z M120.75999999999999 30.2 l0 -5.04 l3.16 0 l0.76 -0.76 l0 -6.6 l-0.76 -0.76 l-3.16 0 l0 -5.04 l5.24 0 l3.72 3.72 l0 10.76 l-3.72 3.72 l-5.24 0 z M114.03999999999998 40 l0 -8.12 l5.04 0 l0 8.12 l-5.04 0 z M114.03999999999998 30.2 l0 -18.2 l5.04 0 l0 18.2 l-5.04 0 z M132.12 40 l2.28 -11.2 l8.56 0 l-1.72 -8.56 l-1.36 6.88 l-5.16 0 l3.04 -15.12 l6.96 0 l4.4 21.84 l-10.6 0 l-1.24 6.16 l-5.16 0 z M145.23999999999998 40 l-0.92 -4.48 l5.16 0 l0.88 4.48 l-5.12 0 z M158.07999999999998 40 l0 -21.28 l5.04 0 l0 21.28 l-5.04 0 z M152.76 17.04 l0 -5.04 l15.68 0 l0 5.04 l-15.68 0 z M171.64 28.52 l0 -16.52 l5.04 0 l0 16.52 l-5.04 0 z M171.64 40 l0 -9.8 l5.04 0 l0 9.8 l-5.04 0 z M178.35999999999999 40 l0 -5.04 l7 0 l0 5.04 l-7 0 z M178.35999999999999 28.52 l0 -5.04 l4.76 0 l0 5.04 l-4.76 0 z M178.35999999999999 17.04 l0 -5.04 l7 0 l0 5.04 l-7 0 z M188.55999999999997 33.28 l0 -21.28 l5.04 0 l0 21.28 l-5.04 0 z M188.55999999999997 40 l0 -5.04 l5.04 0 l0 5.04 l-5.04 0 z M195.27999999999997 40 l0 -5.04 l6.16 0 l0 5.04 l-6.16 0 z"></path></g></svg></a></h1></div>
    </header>
    <main class="">
        <aside class="me">
            <div class="profile-photo-wrapper">
                <img src="/img/profile_sml.webp" alt="Saumil Patel Profile Picture" class="profile-photo" />
            </div>
            <div class="contact-info">
                <h1><a href="/">Saumil Patel</a></h1>
                <span title="I promise I am">IT Professional, Tinkerer, Thinker</span>
                <span class="print-hidden">Code, Thoughts and Ideas</span>
                <div class="social-links print-hidden">
                    <a href="https://github.com/saumilp" target="_blank" title="GitHub">
                        <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <title>GitHub</title>
    <path
        d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"
    />
</svg>

                    </a>
                    <a href="https://gitlab.com/saumilp" target="_blank" title="GitLab">
                        <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <title>GitLab</title>
    <path
        d="m23.6004 9.5927-.0337-.0862L20.3.9814a.851.851 0 0 0-.3362-.405.8748.8748 0 0 0-.9997.0539.8748.8748 0 0 0-.29.4399l-2.2055 6.748H7.5375l-2.2057-6.748a.8573.8573 0 0 0-.29-.4412.8748.8748 0 0 0-.9997-.0537.8585.8585 0 0 0-.3362.4049L.4332 9.5015l-.0325.0862a6.0657 6.0657 0 0 0 2.0119 7.0105l.0113.0087.03.0213 4.976 3.7264 2.462 1.8633 1.4995 1.1321a1.0085 1.0085 0 0 0 1.2197 0l1.4995-1.1321 2.4619-1.8633 5.006-3.7489.0125-.01a6.0682 6.0682 0 0 0 2.0094-7.003z"
    />
</svg>

                    </a>
                    <a href="https://twitter.com/SaumilP10" target="_blank" title="Twitter">
                        <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <title>X</title>
    <path
        d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"
    />
</svg>

                    </a>
                    <a href="https://www.linkedin.com/in/saumil-p-13b72219/" target="_blank" title="LinkedIn">
                        <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <title>LinkedIn</title>
    <path
        d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"
    />
</svg>

                    </a>
                    <a rel="me" href="https://mastodon.social/@saumilp" target="_blank" title="Mastodon">
                        <svg
    fill="#000000"
    viewBox="0 0 24 24"
    xmlns="http://www.w3.org/2000/svg"
    xml:space="preserve"
>
    <path
        d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"
    />
</svg>

                    </a>
                    <a href="mailto:" title="Email Me" class="not-today">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960">
    <path
        d="M160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h640q33 0 56.5 23.5T880-720v480q0 33-23.5 56.5T800-160H160Zm320-280L160-640v400h640v-400L480-440Zm0-80 320-200H160l320 200ZM160-640v-80 480-400Z"
    />
</svg>

                    </a>
                </div>
                <p class="print-hidden">
                    Hey folks, I'm Saumil. I work in tech. Iâ€™m an experienced full-stack software engineer and a tinkerer turned software architect. <br /><br />

                    I like to work with simple things - things can help do day-to-day job easier for any software
                    engineers. Most of the time i am behind a computer trying to find better ways to solve problems.
                    And, obviously i pick up few new things now-and-then when trying to find solutions.<br /><br />

                    Wish to support my work, Click to <a class="print-hidden"
                        href="https://www.buymeacoffee.com/saumilp">buy me a coffee</a>.
                </p>
                <a class="print-hidden" href="/about">About Me</a>
            </div>
        </aside>
        <div class="border"></div>
        <div class="content">
            
<h1 class="title">
    Learning to fly with Rust
    <div class="post-info">2024-04-01</div>
</h1>
<script id="dsq-count-scr" src="//saumilp-github-io.disqus.com/count.js" async></script>
<p><img src="/img/2024/app-on-flyio/rust_in_hotair_balloon.webp" alt="Rust in Flyio" /></p>
<p>Recently I updated my blog-site with <a href="https://www.getzola.org/"><strong>Zola</strong></a>, and then I started thinking to host Rust application on cloud providers. There are multiple CSPs ( <em>Cloud Service Providers</em> ) enabling Rust enthusiasts Developers (also known as &quot;Rustaceans&quot;) to host web-apps on cloud.<span id="continue-reading"></span> Some of the top contenders are AWS, Azure, Heroku, Digital Ocean etc. But for this blog I chose to go with <a href="https://fly.io/"><strong>Fly.io</strong></a> - a CSP that i didn't know, So i thought of giving it a try.</p>
<h2 id="getting-started-with-fly"><a class="zola-anchor" href="#getting-started-with-fly" aria-label="Anchor link for: getting-started-with-fly"><i class="fas fa-link"></i></a> 
Getting started with Fly</h2>
<p>Fly.io is not mature and popular as other CSPs but it shows promising offerings (from developers prospective) &amp; can be considered as good alternative to Heroku to host basic webapps. It seems like a good approach to get app servers up and running quickly on Fly. Simply spin-up a project in a language/framework of your choice, write a sensible Dockerfile fit for running on a server, and deploy to fly platform to just have things work. It also supports PostgreSQL and Redis, but I will cover provisioning and integration some other time.</p>
<p>To get up and running, fly offers a rather nice <a href="https://fly.io/docs/hands-on/install-flyctl/">CLI</a> to help manage our apps/servers and account. Let's start by installing it on our local development machine. I'll be using homebrew, so a quick:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span>&gt; brew install flyctl
</span></code></pre>
<p>You can also use brew with WSL2, please follow instructions mentioend <a href="https://gist.github.com/farhad-taran/41ea3c5f336a09285a9ac9b5c963d051">here</a>.</p>
<p>Above should do the trick for you. Now that we've got the CLI installed, lets go ahead and login with <strong><code>fly auth login</code></strong> and follow the login prompts on the default web-browser. Once we've authenticated, we should be good to start spinning up some apps.</p>
<h2 id="bootstraping-our-service"><a class="zola-anchor" href="#bootstraping-our-service" aria-label="Anchor link for: bootstraping-our-service"><i class="fas fa-link"></i></a> 
Bootstraping our service</h2>
<p>Since we are building a simple web-api with no persistence, let's go and create the app in local machine.</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#a7adba;"># create a new rust-app
</span><span style="color:#bf616a;">$</span><span>&gt; cargo new heya-from-rust
</span></code></pre>
<p>For the application, we'll use <a href="https://tokio.rs/">tokio</a> and <a href="https://github.com/seanmonstar/warp">warp</a>.</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span>&gt; cd heya-from-rust
</span><span style="color:#a7adba;"># Once carog is done with its things, lets add warp dependency
</span><span style="color:#bf616a;">$</span><span>&gt; cargo add warp
</span><span style="color:#a7adba;"># and while we&#39;re at it, let&#39;s grab tokio too
</span><span style="color:#bf616a;">$</span><span>&gt; cargo add tokio</span><span style="color:#bf616a;"> --features</span><span> full
</span><span style="color:#a7adba;"># kick off app build to pull all dependencies
</span><span style="color:#bf616a;">$</span><span>&gt; cargo build
</span></code></pre>
<p>Now that we've got our project bootstrapped, let's look into <ins><strong><code>main.rs</code></strong></ins> and scaffold out a simple default route &quot;/&quot;:</p>
<pre data-lang="rust" style="background-color:#eff1f5;color:#4f5b66;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#![</span><span style="color:#bf616a;">deny</span><span>(warnings)]
</span><span style="color:#b48ead;">use </span><span>warp::Filter;
</span><span>
</span><span>#[</span><span style="color:#bf616a;">tokio</span><span>::</span><span style="color:#bf616a;">main</span><span>]
</span><span>async </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">main</span><span>() {
</span><span>    </span><span style="color:#a7adba;">// Default response
</span><span>    </span><span style="color:#b48ead;">let</span><span> routes = warp::any().</span><span style="color:#96b5b4;">map</span><span>(|| &quot;</span><span style="color:#a3be8c;">Heya!</span><span>&quot;);
</span><span>
</span><span>    </span><span style="color:#a7adba;">// Bind to whatever the hosting interface is - localhost on our machine/container in Fly
</span><span>    warp::serve(routes)
</span><span>        .</span><span style="color:#96b5b4;">run</span><span>(([</span><span style="color:#d08770;">0</span><span>, </span><span style="color:#d08770;">0</span><span>, </span><span style="color:#d08770;">0</span><span>, </span><span style="color:#d08770;">0</span><span>, </span><span style="color:#d08770;">0</span><span>, </span><span style="color:#d08770;">0</span><span>, </span><span style="color:#d08770;">0</span><span>, </span><span style="color:#d08770;">0</span><span>], </span><span style="color:#d08770;">8080</span><span>))
</span><span>        .await;
</span><span>}
</span></code></pre>
<p>Let's spin things up to make sure that we've got water flowing through pipes, so to speak:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span>&gt; cargo run
</span><span>
</span><span style="color:#a7adba;"># in another terminal...
</span><span style="color:#bf616a;">$</span><span>&gt; curl</span><span style="color:#bf616a;"> -l</span><span> http://localhost:8080/
</span><span style="color:#bf616a;">Heya!
</span></code></pre>
<p>Nice! We've got the (arguably) simplest API ready to rockn'roll, now lets get this in the fly.</p>
<h2 id="dockerizing-our-app"><a class="zola-anchor" href="#dockerizing-our-app" aria-label="Anchor link for: dockerizing-our-app"><i class="fas fa-link"></i></a> 
Dockerizing our app</h2>
<p>I'll be the first to admit that I'm far from an experienced docker aficionado - most of my daily docker work is around java, this is the first time I'm trying to package rust-app in docker. Let's add <ins><strong><code>Dockerfile</code></strong></ins> to build and package the app. Here i'm using multi-stage build for our app. Fly allows hosting of the Dockerfile natively, and so it is very easy to build, register the image and deploy to platform.</p>
<pre data-lang="dockerfile" style="background-color:#eff1f5;color:#4f5b66;" class="language-dockerfile "><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#b48ead;">FROM</span><span> rust:1-bookworm </span><span style="color:#b48ead;">as </span><span style="color:#bf616a;">builder
</span><span style="color:#b48ead;">WORKDIR </span><span>/usr/src/app
</span><span style="color:#b48ead;">COPY</span><span> . .
</span><span style="color:#b48ead;">RUN </span><span>--mount=type=cache,target=/usr/local/cargo,from=rust:latest,source=/usr/local/cargo \
</span><span>    --mount=type=cache,target=target \
</span><span>    cargo build --release &amp;&amp; mv ./target/release/heya ./heya
</span><span>
</span><span style="color:#a7adba;"># Runtime image
</span><span style="color:#b48ead;">FROM</span><span> debian:bookworm-slim
</span><span style="color:#b48ead;">RUN </span><span>useradd -ms /bin/bash app
</span><span style="color:#b48ead;">USER </span><span>app
</span><span style="color:#b48ead;">WORKDIR </span><span>/app
</span><span style="color:#b48ead;">COPY</span><span> --from=</span><span style="color:#bf616a;">builder</span><span> /usr/src/app/heya /app/heya
</span><span>CMD ./heya
</span></code></pre>
<p>With our Dockerfile in place, let's build the bad boy:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span>&gt; docker build .</span><span style="color:#bf616a;"> -t</span><span> heya-from-rust
</span></code></pre>
<p>After a lengthy initial build (successive builds will be quicker, thanks to docker layering), we can spin up our container locally and verify we're still looking good from a server prospective:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span>&gt; docker run</span><span style="color:#bf616a;"> -d -p</span><span> 8080:8080</span><span style="color:#bf616a;"> --name</span><span> heya_from_rust</span><span style="color:#bf616a;"> -it</span><span> heya-from-rust
</span></code></pre>
<p>After a few seconds, we should see the container detaching in terminal and if we send a HTTP request, we should see the same output:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span>&gt; curl</span><span style="color:#bf616a;"> -l</span><span> http://localhost:8080
</span><span style="color:#bf616a;">Heya!
</span></code></pre>
<p>Our app is running in a containerized manner, now let's get this things deployed on Fly!</p>
<h2 id="deploying-to-fly"><a class="zola-anchor" href="#deploying-to-fly" aria-label="Anchor link for: deploying-to-fly"><i class="fas fa-link"></i></a> 
Deploying to Fly</h2>
<p>Alright, Deploying to fly requires some pre-reading specially around some of the basic commands, but not difficult. Let's figure out how this deployment story looks like. There is gotta be something in the CLI, right? let's do a bit of trial and error:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span>&gt; fly
</span><span style="color:#bf616a;">This</span><span> is flyctl, the Fly.io command line interface.
</span><span>
</span><span style="color:#bf616a;">Heres</span><span> a few commands to get you started:
</span><span>  </span><span style="color:#bf616a;">fly</span><span> launch      Launch a new application
</span><span>  </span><span style="color:#bf616a;">fly</span><span> apps        Create and manage apps
</span><span>  </span><span style="color:#bf616a;">fly</span><span> postgres    Create and manage Postgres databases
</span><span>  </span><span style="color:#bf616a;">fly</span><span> redis       Create and manage Redis databases
</span><span>  </span><span style="color:#bf616a;">fly</span><span> machines    Create and manage individual Fly.io machines
</span><span>
</span><span style="color:#bf616a;">If</span><span> you need help along the way:
</span><span>  </span><span style="color:#bf616a;">fly</span><span> help            Display a complete list of commands
</span><span>  </span><span style="color:#bf616a;">fly</span><span> help &lt;command&gt;  Display help for a specific command, e.g. &#39;</span><span style="color:#a3be8c;">fly help launch</span><span>&#39;
</span><span>
</span><span style="color:#bf616a;">Visit</span><span> https://fly.io/docs for additional documentation &amp; </span><span style="color:#bf616a;">guides
</span></code></pre>
<p>Okay... <strong><code>fly launch</code></strong> looks promising, let's check it out:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span>&gt; fly </span><span style="color:#96b5b4;">help</span><span> launch
</span><span style="color:#bf616a;">Create</span><span> and configure a new app from source code or a Docker image.
</span><span>
</span><span style="color:#bf616a;">Usage:
</span><span>  </span><span style="color:#bf616a;">flyctl</span><span> launch </span><span style="color:#b48ead;">[</span><span>flags</span><span style="color:#b48ead;">]
</span><span>
</span><span style="color:#bf616a;">Flags:
</span><span>      </span><span style="color:#a7adba;"># ...a bunch of options and whatnot
</span></code></pre>
<p>Alright, this looks like <ins>exactly</ins> what we need. We have a Dockerfile, and all we need to put this thing on the fly app server. Let's take it for a spin:</p>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span>&gt; fly launch
</span></code></pre>
<p>We get asked a bunch of questions, like we want the app named, where it should be located, etc. What's even neater is that fly generates a config file for us in the <strong><code>fly.toml</code></strong> that now appears in our editor:</p>
<pre data-lang="toml" style="background-color:#eff1f5;color:#4f5b66;" class="language-toml "><code class="language-toml" data-lang="toml"><span style="color:#bf616a;">app </span><span>= &#39;</span><span style="color:#a3be8c;">${APP_NAME}</span><span>&#39;
</span><span style="color:#bf616a;">primary_region </span><span>= &#39;</span><span style="color:#a3be8c;">${REGION}</span><span>&#39;
</span><span style="color:#bf616a;">kill_signal </span><span>= &#39;</span><span style="color:#a3be8c;">SIGINT</span><span>&#39;
</span><span style="color:#bf616a;">kill_timeout </span><span>= &#39;</span><span style="color:#a3be8c;">5s</span><span>&#39;
</span><span>
</span><span>[build]
</span><span>    </span><span style="color:#bf616a;">dockerfile </span><span>= &quot;</span><span style="color:#a3be8c;">Dockerfile</span><span>&quot;
</span><span>    </span><span style="color:#bf616a;">ignorefile </span><span>= &quot;</span><span style="color:#a3be8c;">./dockerignore</span><span>&quot;
</span><span>
</span><span>[env]
</span><span>  </span><span style="color:#bf616a;">FLY_SCALE_TO_ZERO </span><span>= &#39;</span><span style="color:#a3be8c;">15m</span><span>&#39;
</span><span>  </span><span style="color:#bf616a;">PORT </span><span>= &#39;</span><span style="color:#a3be8c;">8080</span><span>&#39;
</span><span>  </span><span style="color:#bf616a;">PRIMARY_REGION </span><span>= &#39;</span><span style="color:#a3be8c;">${REGION}</span><span>&#39;
</span><span>
</span><span>[http_service]
</span><span>  </span><span style="color:#bf616a;">internal_port </span><span>= </span><span style="color:#d08770;">8080
</span><span>  </span><span style="color:#bf616a;">force_https </span><span>= </span><span style="color:#d08770;">true
</span><span>  </span><span style="color:#bf616a;">auto_stop_machines </span><span>= </span><span style="color:#d08770;">true
</span><span>  </span><span style="color:#bf616a;">auto_start_machines </span><span>= </span><span style="color:#d08770;">true
</span><span>  </span><span style="color:#bf616a;">min_machines_running </span><span>= </span><span style="color:#d08770;">0
</span><span>
</span><span>[[services]]
</span><span>  </span><span style="color:#bf616a;">protocol </span><span>= &#39;</span><span style="color:#a3be8c;">tcp</span><span>&#39;
</span><span>  </span><span style="color:#bf616a;">internal_port </span><span>= </span><span style="color:#d08770;">8080
</span><span>
</span><span>[[services.ports]]
</span><span>    </span><span style="color:#bf616a;">port </span><span>= </span><span style="color:#d08770;">80
</span><span>    </span><span style="color:#bf616a;">handlers </span><span>= [&#39;</span><span style="color:#a3be8c;">http</span><span>&#39;]
</span><span>
</span><span>[[services.ports]]
</span><span>    </span><span style="color:#bf616a;">port </span><span>= </span><span style="color:#d08770;">443
</span><span>    </span><span style="color:#bf616a;">handlers </span><span>= [&#39;</span><span style="color:#a3be8c;">tls</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">http</span><span>&#39;]
</span><span>
</span><span>  [services.concurrency]
</span><span>    </span><span style="color:#bf616a;">hard_limit </span><span>= </span><span style="color:#d08770;">25
</span><span>    </span><span style="color:#bf616a;">soft_limit </span><span>= </span><span style="color:#d08770;">20
</span><span>
</span><span>[[services.tcp_checks]]
</span><span>    </span><span style="color:#bf616a;">interval </span><span>= &#39;</span><span style="color:#a3be8c;">15s</span><span>&#39;
</span><span>    </span><span style="color:#bf616a;">timeout </span><span>= &#39;</span><span style="color:#a3be8c;">2s</span><span>&#39;
</span><span>    </span><span style="color:#bf616a;">grace_period </span><span>= &#39;</span><span style="color:#a3be8c;">1s</span><span>&#39;
</span><span>    </span><span style="color:#bf616a;">port </span><span>= &quot;</span><span style="color:#a3be8c;">8080</span><span>&quot;
</span><span>    </span><span style="color:#bf616a;">restart_limit </span><span>= </span><span style="color:#d08770;">6
</span><span>
</span><span>[[vm]]
</span><span>  </span><span style="color:#bf616a;">size </span><span>= &#39;</span><span style="color:#a3be8c;">shared-cpu-1x</span><span>&#39;
</span></code></pre>
<p><strong><code>fly launch</code></strong> command output looks like this:</p>
<p><img src="/img/2024/app-on-flyio/fly_launch.webp" alt="Fly launch" /></p>
<p>And, docker build part of deployment:</p>
<p><img src="/img/2024/app-on-flyio/fly_launch_docker.webp" alt="Docker build" /></p>
<p>We wait a bit, and check the console as we sit on the edge of our seats in anticipation of a successful deployment, and ... its SUCCESS ðŸ’ª!</p>
<p>Now, if we try testing the same cURL test with fly hostname, we should be able to see correct output. This confirms that deployment was successful, and we've managed to complete deployment ðŸ™Œ!</p>
<p><img src="/img/2024/app-on-flyio/curl_test.webp" alt="Simple test" /></p>
<p>Now if we check fly.io Dashboard, then we should be able to locate the machine. On left menu options, if we look at <strong>Metrics</strong>, then it provides nice basic info on our app. It also has button for Grafana dashboards. Below image shows basic grafana overview.</p>
<p><img src="/img/2024/app-on-flyio/grafana_app_overview.webp" alt="Sneak peak at dashboard" /></p>
<p>From <strong>Dashboards</strong>, <strong><code>Fly app</code></strong> appears showing more insights into collected <strong>Metrics</strong>. Out-of-box such metrics are more useful and easier for most of the devs to keep an eye on the deployed app.</p>
<p><strong>HTTP Status codes</strong></p>
<p><img src="/img/2024/app-on-flyio/metrics_http_status_codes.webp" alt="Http Status codes" /></p>
<p><strong>HTTP Response times</strong></p>
<p><img src="/img/2024/app-on-flyio/metrics_http_response_times_view.webp" alt="Http Response times" /></p>
<p><strong>Data Transfer</strong></p>
<p><img src="/img/2024/app-on-flyio/metrics_data_transfer_view.webp" alt="Data tranfer" /></p>
<h2 id="wrapping-up"><a class="zola-anchor" href="#wrapping-up" aria-label="Anchor link for: wrapping-up"><i class="fas fa-link"></i></a> 
Wrapping up</h2>
<p>In my attempt to find developer-friendly hosting platform and alternate to Heroku/AWS/Azure, I've been thoroughly satisfied with what Fly offers. I'm excited to see what else I can build, and deploy.</p>
<p>All the code we wrote today, you can find it in my <a href="https://github.com/SaumilP/tryouts/tree/master/rust/flyio-sample-app">repo</a>.</p>


<div class="back-to-top">
    <b><a href="https://saumilp.github.io/blog/app-on-flyio/" title="Back to top">
        Back to Top<?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"
 "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
 width="15pt" height="15pt" viewBox="0 0 1069.000000 1280.000000"
 preserveAspectRatio="xMidYMid meet">
<g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)"
fill="#000000" stroke="none">
<path d="M2784 10009 l-2559 -2559 1573 0 1572 0 0 -169 0 -170 43 -6 c23 -3
917 -4 1987 -3 l1945 3 0 173 0 172 1553 0 c853 0 1552 3 1552 7 0 7 -5032
5048 -5081 5090 l-25 22 -2560 -2560z"/>
<path d="M3370 6825 l0 -255 1988 2 1987 3 3 190 c2 105 0 218 -3 253 l-7 62
-1984 0 -1984 0 0 -255z"/>
<path d="M3370 6280 l0 -230 1988 2 1987 3 3 175 c2 96 0 199 -3 228 l-6 52
-1985 0 -1984 0 0 -230z"/>
<path d="M3370 5735 l0 -215 1990 0 1990 0 0 169 c0 92 -3 189 -6 215 l-7 46
-1983 0 -1984 0 0 -215z"/>
<path d="M3370 5191 l0 -200 53 -6 c28 -3 923 -5 1987 -3 l1935 3 3 140 c2 77
0 168 -3 203 l-7 62 -1984 0 -1984 0 0 -199z"/>
<path d="M3372 4643 l3 -178 1985 0 1985 0 3 125 c2 69 0 149 -3 178 l-6 52
-1985 0 -1984 0 2 -177z"/>
<path d="M3370 4095 l0 -165 1988 2 1987 3 3 100 c2 55 0 128 -3 163 l-7 62
-1984 0 -1984 0 0 -165z"/>
<path d="M3370 3550 l0 -150 1990 0 1990 0 0 104 c0 57 -3 124 -6 150 l-7 46
-1983 0 -1984 0 0 -150z"/>
<path d="M3377 3133 c-4 -3 -7 -62 -7 -130 l0 -123 1990 0 1990 0 0 84 c0 46
-3 104 -6 130 l-7 46 -1977 0 c-1087 0 -1980 -3 -1983 -7z"/>
<path d="M3370 2461 l0 -110 43 -6 c23 -3 917 -4 1987 -3 l1945 3 3 60 c2 33
1 84 -3 113 l-6 52 -1985 0 -1984 0 0 -109z"/>
<path d="M3370 1910 l0 -100 1988 2 1987 3 3 35 c2 19 1 63 -3 98 l-7 62
-1984 0 -1984 0 0 -100z"/>
<path d="M3370 1370 l0 -80 1985 0 c1767 0 1986 2 1991 15 4 9 3 45 -1 80 l-7
65 -1984 0 -1984 0 0 -80z"/>
<path d="M3370 820 l0 -60 1990 0 1990 0 0 23 c0 12 -3 39 -6 60 l-7 37 -1983
0 -1984 0 0 -60z"/>
<path d="M3370 276 l0 -43 46 -7 c69 -9 3922 -7 3928 2 2 4 2 27 -1 50 l-6 42
-1983 0 -1984 0 0 -44z"/>
</g>
</svg>

    </b></a>
</div><br />

<div id="disqus_thread"></div>
<script>
    (function() {
        var d = document, s = d.createElement('script');
        s.src = 'https://saumilp-github-io.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


        </div>
    </main>
    <footer class="page-footer">
        <small>
            <p class="page-copyright">
                
                Powered by <a href="https://www.getzola.org" target="_blank" rel="noopener">Zola</a> | &copy; Saumil Patel | <a href="https://saumilp.github.io/atom.xml" target="_blank">RSS</a>
            </p>
        </small>
    </footer>

    <a
    href="https://github.com/saumilp/saumilp.github.io"
    class="github-corner print-hidden"
    aria-label="View source on GitHub"
>
    <svg
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        viewBox="0 0 80 80"
        width="62pt"
        height="62pt"
        style="
            fill: #151513;
            color: #fff;
            position: absolute;
            top: 0;
            border: 0;
            right: 0;
        "
        aria-hidden="true"
    >
        <defs>
            <clipPath id="_clipPath_kekDrk9tRbWqRr4kEErigMnoXeJdMRR7">
                <rect width="80" height="80" />
            </clipPath>
        </defs>
        <g clip-path="url(#_clipPath_kekDrk9tRbWqRr4kEErigMnoXeJdMRR7)">
            <path
                d=" M 0 0 L 36.8 36.8 L 41.6 36.8 L 45.44 45.44 L 80 80 L 80 0 L 0 0 Z "
            />
            <path
                d=" M 51.2 16 Q 52.297 13.609 55.04 12.48 C 55.238 12.399 56.922 14.469 57.28 17.6 L 51.2 16 Z  M 64 24.32 C 66.853 24.945 68.656 25.72 69.44 26.56 C 69.539 26.666 67.852 29.668 65.92 30.08 L 64 24.32 Z "
                fill-rule="evenodd"
                fill="currentColor"
                class="octo-ears"
                style="transform-origin: 130px 106px"
            />
            <path
                d=" M 40.96 34.88 C 36.16 32 38.08 28.8 38.08 28.8 C 39.04 26.56 38.72 25.28 38.72 25.28 C 38.4 23.04 39.68 24.64 39.68 24.64 C 40.96 26.24 40.32 28.16 40.32 28.16 C 39.36 31.36 41.92 32.96 43.2 33.28"
                fill="currentColor"
                class="octo-arm"
            />
            <path
                d=" M 36.8 36.8 C 36.8 36.8 38.08 37.44 38.4 36.8 L 42.88 32.32 C 43.84 31.68 44.8 31.36 45.44 31.36 C 42.88 27.84 40.64 23.68 46.08 18.24 C 47.68 16.64 49.28 16 51.2 16 C 53.594 15.953 54.422 16.172 57.28 17.6 C 58.56 18.24 59.84 19.2 61.12 20.48 C 62.4 21.76 63.36 23.04 64 24.32 C 65.063 26.031 65.5 27.438 65.92 30.08 C 65.92 32 65.28 33.6 63.68 35.2 C 58.56 40.32 54.08 38.4 50.56 35.84 C 50.56 36.8 50.24 38.08 48.96 39.36 L 45.12 42.88 C 44.8 43.2 45.44 44.48 45.44 44.48 L 36.8 36.8 Z "
                fill="currentColor"
                class="octo-body"
            />
        </g>
    </svg>
</a>

<style>
    .github-corner:hover .octo-ears {
        animation: octocat-flap 460ms ease-in-out;
    }

    @keyframes octocat-flap {
        0%,
        100% {
            transform: rotate(0);
        }

        20%,
        60% {
            transform: rotate(-3deg);
        }

        40%,
        80% {
            transform: rotate(0deg);
        }
    }

    @media (max-width: 500px) {
        .github-corner:hover .octo-ears {
            animation: none;
        }

        .github-corner .octo-ears {
            animation: octocat-flap 460ms ease-in-out;
        }
    }
</style>


     
    <script src="/js/script.js"></script>
</body>

</html>
